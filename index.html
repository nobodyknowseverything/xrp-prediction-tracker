<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XRP Live Global Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/three@0.118.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.118.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/three-globe@2.16.0/dist/three-globe.min.js"></script>
<style>
  body{margin:0;background:#000;color:#fff;font-family:system-ui}
  #globeViz{width:100%;height:560px}
  @media(max-width:768px){#globeViz{height:360px}}
</style>
</head>
<body>
<div class="max-w-7xl mx-auto p-6 space-y-12">
  <h1 class="text-center text-5xl font-bold bg-gradient-to-r from-cyan-400 to-blue-600 bg-clip-text text-transparent">
    XRP Live Global Dashboard
  </h1>
  <div class="grid lg:grid-cols-3 gap-8">
    <!-- Globe -->
    <div class="lg:col-span-2 bg-gray-950 rounded-3xl overflow-hidden border border-cyan-900/40 shadow-2xl">
      <div class="p-6 border-b border-gray-800">
        <h2 class="text-2xl font-bold">Live Global Trade Flow</h2>
        <p class="text-cyan-300 text-sm">Green arcs = buys Red arcs = sells (appears in 3–5 seconds)</p>
      </div>
      <div id="globeViz"></div>
    </div>
    <!-- Right column -->
    <div class="space-y-6">
      <div class="grid grid-cols-2 gap-6">
        <div class="bg-gray-900/90 rounded-2xl p-6 border border-gray-800">
          <div class="text-gray-400 text-sm">XRP Price</div>
          <div id="price" class="text-4xl font-bold">$?.????</div>
          <div id="change" class="text-green-400 mt-1">—</div>
        </div>
        <div class="bg-gray-900/90 rounded-2xl p-6 border border-gray-800">
          <div class="text-gray-400 text-sm">24h Volume</div>
          <div id="volume" class="text-3xl font-bold">$?.??B</div>
        </div>
      </div>
      <div class="bg-gray-900/90 rounded-2xl p-6 border border-gray-800">
        <h3 class="font-bold mb-3">Live Trades</h3>
        <div id="trades" class="text-sm space-y-1 max-h-64 overflow-y-auto"></div>
      </div>
      <div class="bg-gray-900/90 rounded-2xl p-6 text-center border border-gray-800">
        <div class="text-gray-400 text-sm">Order-Book Depth (top 10)</div>
        <div class="text-3xl font-bold mt-3">
          <span class="text-green-400" id="bid">?.?k</span> │ <span class="text-red-400" id="ask">?.?k</span> XRP
        </div>
      </div>
    </div>
  </div>
  <!-- ETF Cards -->
  <div class="grid grid-cols-2 md:grid-cols-5 gap-6" id="etfContainer"></div>
  <!-- Clock -->
  <div class="text-center py-12 bg-gradient-to-r from-cyan-900/40 to-blue-900/40 rounded-3xl border border-cyan-700">
    <div id="status" class="text-6xl font-bold text-green-400">LOADING</div>
    <div id="clock" class="text-7xl font-mono my-6">--:--:-- ET</div>
  </div>
</div>
<script>
try {
  // Globe setup
  const globeVizEl = document.getElementById('globeViz');
  const globe = new window.ThreeGlobe()
    .globeImageUrl('https://unpkg.com/three-globe@2.16.0/example/img/earth-blue-marble.jpg')
    .bumpImageUrl('https://unpkg.com/three-globe@2.16.0/example/img/earth-topology.png')
    .backgroundImageUrl('https://unpkg.com/three-globe@2.16.0/example/img/night-sky.png')
    .showAtmosphere(true)
    .atmosphereColor('#00ccff')
    .atmosphereAltitude(0.22);

  const scene = new THREE.Scene();
  scene.add(globe);
  scene.add(new THREE.AmbientLight(0xbbbbbb));
  scene.add(new THREE.DirectionalLight(0xffffff, 0.8));

  const camera = new THREE.PerspectiveCamera();
  camera.position.z = 320;

  const renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
  renderer.setPixelRatio(window.devicePixelRatio);
  function updateRendererSize() {
    const width = globeVizEl.offsetWidth;
    const height = globeVizEl.offsetHeight;
    renderer.setSize(width, height);
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
  }
  updateRendererSize();
  globeVizEl.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.6;
  controls.enableZoom = false;

  (function anim() {
    controls.update();
    globe.rotation.y += 0.001;
    renderer.render(scene, camera);
    requestAnimationFrame(anim);
  })();

  // Resize handler
  window.addEventListener('resize', updateRendererSize);
  console.log('Globe initialized successfully');
} catch (e) {
  console.error('Globe init error:', e);
  document.getElementById('globeViz').innerHTML = '<div class="flex items-center justify-center h-full text-red-400">Globe failed to load—check console.</div>';
}

// Arc shooter
const cities = [
  {lat:40.7,lng:-74},{lat:51.5,lng:-0.1},{lat:35.7,lng:139.7},
  {lat:1.35,lng:103.8},{lat:-33.9,lng:151.2}
];
function shootArc() {
  const c = cities[Math.floor(Math.random()*cities.length)];
  const buy = Math.random() > 0.45;
  const arc = {
    startLat: c.lat, startLng: c.lng,
    endLat: 0, endLng: 0,
    color: buy ? '#10b981' : '#ef4444',
    stroke: buy ? 1.4 : 1
  };
  if (window.globe) {
    window.globe.arcsData([...(window.globe.arcsData() || []), arc]);
    setTimeout(() => {
      if (window.globe) {
        window.globe.arcsData((window.globe.arcsData() || []).filter(a => a !== arc));
      }
    }, 4000);
  }
}

// Live trade + arc
let price = 2.21;
function addTrade(){
  const buy = Math.random() > 0.5;
  const qty = (Math.random()*110 + 20).toFixed(1);
  price += (Math.random()-0.5)*0.004;
  const el = document.createElement('div');
  el.className = buy ? 'text-green-400' : 'text-red-400';
  el.textContent = `${new Date().toLocaleTimeString().slice(0,8)} ${qty} XRP $${price.toFixed(4)}`;
  const tradesEl = document.getElementById('trades');
  tradesEl.prepend(el);
  if(tradesEl.children.length > 15) tradesEl.lastChild.remove();
  shootArc();
}

// Price refresh
async function updatePrice(){
  try {
    const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true');
    if (!r.ok) throw new Error('Fetch failed');
    const j = await r.json();
    price = j.ripple.usd;
    document.getElementById('price').textContent = '$'+price.toFixed(4);
    const changeEl = document.getElementById('change');
    const change = j.ripple.usd_24h_change;
    changeEl.textContent = (change>0?'+':'')+change.toFixed(2)+'%';
    changeEl.className = change>0 ? 'text-green-400 mt-1' : 'text-red-400 mt-1';
    document.getElementById('volume').textContent = '$'+(j.ripple.usd_24hr_vol/1e9).toFixed(2)+'B';
    console.log('Price updated:', price);
  } catch (e) {
    console.error('Price fetch error:', e);
    // Fallback simulation
    price += (Math.random()-0.5)*0.01;
    document.getElementById('price').textContent = '$'+price.toFixed(4);
  }
}
setInterval(updatePrice, 5000);
updatePrice(); // Initial call

// Depth simulation
setInterval(()=>{
  document.getElementById('bid').textContent = (7+Math.random()*3).toFixed(1)+'k';
  document.getElementById('ask').textContent = (5+Math.random()*3).toFixed(1)+'k';
}, 9000);

// ETFs (hardcoded for demo)
['Canary XRPC $243M','Bitwise XRPT $135M','Franklin EZRP $63M','Grayscale GXRP $67M','21Shares AXRP $5M'].forEach(t=>{
  const d=document.createElement('div');
  d.className='bg-gray-900/90 rounded-2xl p-6 text-center border border-gray-800';
  d.innerHTML=`<div class="font-bold">${t.split(' ')[0]} ${t.split(' ')[1]}</div><div class="text-3xl font-bold text-cyan-300">${t.split(' ')[2]}</div><div class="text-sm text-gray-400">purchased</div>`;
  document.getElementById('etfContainer').appendChild(d);
});

// Clock
function tick(){
  try {
    const et = new Date().toLocaleString("en-US",{timeZone:"America/New_York"});
    const d = new Date(et);
    const live = d.getDay()>=1 && d.getDay()<=5 && d.getHours()>=9 && d.getHours()<16;
    document.getElementById('clock').textContent = d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false})+' ET';
    const statusEl = document.getElementById('status');
    statusEl.textContent = live ? 'LIVE' : 'CLOSED';
    statusEl.className = live ? 'text-6xl font-bold text-green-400' : 'text-6xl font-bold text-red-400';
  } catch (e) {
    console.error('Clock error:', e);
  }
}
setInterval(tick, 1000);
tick();

// Start trades
setTimeout(addTrade, 2000); // First trade
setInterval(addTrade, 3100);
console.log('Dashboard started');
</script>
</body>
</html>
