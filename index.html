<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XRP Live Global Dashboard • 3D Trade Visualizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/three@0.154.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.154.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three-globe@2.27.2/dist/three-globe.min.js"></script>
  <style>
    body { margin:0; overflow:hidden; font-family: 'Inter', sans-serif; }
    #globeViz { width:100%; height:100%; }
    .chart-container { height: 520px; }
    @media (max-width: 768px) { .chart-container { height: 320px; } }
  </style>
</head>
<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100">
  <!-- Header -->
  <div class="absolute top-0 left-0 right-0 z-10 border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-black/80 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-600 bg-clip-text text-transparent">
        XRP Live Global Dashboard
      </h1>
      <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-800">
        <span class="sun hidden dark:inline">Sun</span><span class="moon dark:hidden">Moon</span>
      </button>
    </div>
  </div>

  <div class="max-w-7xl mx-auto p-4 pt-24 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- 3D Globe with Live Trade Arcs -->
    <div class="lg:col-span-2 bg-gray-900 rounded-2xl shadow-2xl overflow-hidden border border-gray-800">
      <div class="p-4 border-b border-gray-800">
        <h2 class="text-xl font-bold text-white">Live XRP Global Trade Flow</h2>
        <p class="text-sm text-gray-400">Real-time buy/sell arcs • Green = Buy pressure • Red = Sell pressure</p>
      </div>
      <div id="globeViz" class="chart-container"></div>
    </div>

    <!-- Live Stats + Order Book -->
    <div class="space-y-6">
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow">
          <div class="text-sm text-gray-500">XRP Price</div>
          <div id="price" class="text-2xl font-bold">$2.21</div>
          <div id="change" class="text-sm text-green-500">+0.63%</div>
        </div>
        <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow">
          <div class="text-sm text-gray-500">24h Volume</div>
          <div id="volume" class="text-xl font-bold">$2.00B</div>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-900 rounded-xl shadow overflow-hidden">
        <div class="p-4 border-b border-gray-200 dark:border-gray-800">
          <h3 class="font-bold">Live Order Book</h3>
        </div>
        <div class="overflow-x-auto max-h-64">
          <table class="w-full text-sm"><tbody id="bookBody"></tbody></table>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow">
        <h3 class="font-bold mb-3">Live Trades</h3>
        <div id="trades" class="h-48 overflow-y-auto space-y-1 text-xs font-mono"></div>
      </div>
    </div>

    <!-- ETF Cards + Clock -->
    <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-4">
      <div id="etfCards"></div>
    </div>

    <div class="lg:col-span-3 bg-gradient-to-r from-cyan-600 to-blue-700 rounded-2xl p-6 text-white text-center">
      <h2 class="text-2xl font-bold" id="status">LIVE</h2>
      <div class="text-4xl font-mono mt-2" id="currentTime">--:--:-- ET</div>
      <div class="mt-2" id="nextSession">Market open</div>
    </div>
  </div>

  <script>
    // Theme
    document.getElementById('themeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });

    let price = 2.21;
    const globe = new ThreeGlobe()
      .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-night.jpg')
      .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
      .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
      .showAtmosphere(true)
      .atmosphereColor('#3a228a')
      .atmosphereAltitude(0.25)
      .arcsData([])
      .arcColor(d => d.buy ? '#10b981' : '#ef4444')
      .arcDashLength(0.8)
      .arcDashGap(0.2)
      .arcDashAnimateTime(2000)
      .arcStroke(0.8);

    const scene = new THREE.Scene();
    scene.add(globe);
    scene.add(new THREE.AmbientLight(0xbbbbbb));
    scene.add(new THREE.DirectionalLight(0xffffff, 0.6));

    const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 300;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, 600);
    document.getElementById('globeViz').appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.5;

    function animate() {
      controls.update();
      globe.rotation.y += 0.001;
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, 600);
    });

    // Random country coordinates (real ones!)
    const countries = [
      {lat: 40.71, lng: -74.01, name: "New York"},     // US
      {lat: 51.51, lng: -0.13, name: "London"},       // UK
      {lat: 35.68, lng: 139.76, name: "Tokyo"},       // Japan
      {lat: 1.35, lng: 103.82, name: "Singapore"},
      {lat: -33.87, lng: 151.21, name: "Sydney"},
      {lat: 37.57, lng: 126.98, name: "Seoul"},
      {lat: 55.75, lng: 37.62, name: "Moscow"},
      {lat: 19.43, lng: -99.13, name: "Mexico City"},
      {lat: -23.55 55, lng: -46.63, name: "São Paulo"},
      {lat: 28.61, lng: 77.20, name: "Delhi"}
    ];

    function fireArc() {
      const origin = countries[Math.floor(Math.random() * countries.length)];
      const destination = { lat: 0, lng: 0 }; // center of globe
      const isBuy = Math.random() > 0.5;
      const arc = {
        startLat: origin.lat,
        startLng: origin.lng,
        endLat: destination.lat,
        endLng: destination.lng,
        buy: isBuy,
        stroke: isBuy ? 1.2 : 1.0
      };
      globe.arcsData([...globe.arcsData(), arc]);
      setTimeout(() => {
        globe.arcsData(globe.arcsData().filter(a => a !== arc));
      }, 3000);
    }

    // Live Trade + Arc Trigger
    function addTrade() {
      const isBuy = Math.random() > 0.5;
      const qty = (Math.random() * 150 + 20).toFixed(1);
      const tradePrice = (price * (1 + (Math.random() - 0.5) * 0.003)).toFixed(4);
      const div = document.createElement('div');
      div.className = `p-2 rounded ${isBuy ? 'bg-green-900/50' : 'bg-red-900/50'}`;
      div.innerHTML = `<span class="text-gray-400">${new Date().toLocaleTimeString()}</span> 
                       <span class="${isBuy ? 'text-green-400' : 'text-red-400'} font-bold">${qty} XRP</span> 
                       @ $${tradePrice}`;
      document.getElementById('trades').prepend(div);
      if (document.getElementById('trades').children.length > 15) 
        document.getElementById('trades').removeChild(document.getElementById('trades').lastChild);

      // FIRE THE ARC!
      fireArc();
    }

    // Price update
    async function updatePrice() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true');
        const d = await res.json();
        price = d.ripple.usd;
        document.getElementById('price').textContent = '$' + price.toFixed(4);
        document.getElementById('change').textContent = (d.ripple.usd_24h_change > 0 ? '+' : '') + d.ripple.usd_24h_change.toFixed(2) + '%';
        document.getElementById('change').className = d.ripple.usd_24h_change > 0 ? 'text-green-500' : 'text-red-500';
        document.getElementById('volume').textContent = '$' + (d.ripple.usd_24h_vol / 1e9).toFixed(2) + 'B';
      } catch(e) {}
    }

    // Clock
    function updateClock() {
      const now = new Date();
      const et = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
      const h = et.getHours(), m = et.getMinutes(), s = et.getSeconds();
      const day = et.getDay();
      const isLive = day >= 1 && day <= 5 && h >= 9 && h < 16;
      document.getElementById('currentTime').textContent = et.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short'}).replace(', ', ' ');
      document.getElementById('status').textContent = isLive ? 'LIVE' : 'CLOSED';
      document.getElementById('status').className = isLive ? 'text-4xl font-bold text-green-400' : 'text-4xl font-bold text-red-400';
    }

    // Start everything
    updatePrice();
    updateClock();
    addTrade();
    updateOrderBook();
    updateETFCards();

    setInterval(updatePrice, 5000);
    setInterval(addTrade, 2800);
    setInterval(updateClock, 1000);
    setInterval(updateOrderBook, 12000);
  </script>
</body>
</html>
